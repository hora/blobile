!function(){function e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function t(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}(window.webpackJsonp=window.webpackJsonp||[]).push([[10],{jNFB:function(e,t,n){"use strict";function i(e){return(i="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0,t.default=function(){function e(t){if(function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),"object"===i(t))this.el=t;else{if("string"!=typeof t)throw new TypeError("Marquee accepts either a HTML Element (object) or a class/id to query (string).");this.el=document.querySelector(t)}this.sign=this.el.children[0],this.RAF=null,this.offset=this.el.offsetWidth,this.speed=this.el.dataset.speed||1,this.observerOptions={rootMargin:"0px 0px",threshold:0},this.observer=null,this.styleElements(),this.init()}return function(e,t,n){t&&function(e,t){for(var n,i=0;i<t.length;i++)(n=t[i]).enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}(e.prototype,t)}(e,[{key:"init",value:function(){this.observerInit(),this.observer.observe(this.sign),this.draw()}},{key:"styleElements",value:function(){this.el.style.display="flex",this.sign.style.display="inline-flex"}},{key:"draw",value:function(){var e=this;requestAnimationFrame((function t(){e.RAF=requestAnimationFrame(t),e.offset-=e.speed,e.sign.style.transform="translate3d(".concat(e.offset,"px, 0, 0)")}))}},{key:"stop",value:function(){cancelAnimationFrame(this.RAF)}},{key:"reset",value:function(){this.offset=this.el.offsetWidth,this.sign.style.transform="translate3d(".concat(this.offset,"px, 0, 0)")}},{key:"observerInit",value:function(){var e=this;this.observer=new IntersectionObserver((function(t){t.forEach((function(t){0===t.intersectionRatio&&e.reset()}))}),this.observerOptions)}},{key:"destroy",value:function(){this.stop(),this.observer.unobserve(this.sign)}}]),e}()},v2dp:function(n,i,a){"use strict";a.r(i),a.d(i,"LiveFeedPageModule",(function(){return B}));var o=a("TEn/"),s=a("ofXK"),r=a("3Pt+"),c=a("Uyg3"),u=a("tyNb"),l=a("mrSG"),b=a("gcOT"),f=a("jNFB"),h=a.n(f),d=a("+BjT"),m=a("oVdi"),v=a("fXoL"),g=a("N1zj"),p=a("J+wX"),y=a("BTjV"),k=a("9Pn0");function w(e,t){1&e&&(v.Nb(0,"ion-button"),v.Lb(1,"ion-spinner"),v.Mb())}function N(e,t){if(1&e){var n=v.Ob();v.Nb(0,"ion-toolbar"),v.Nb(1,"ion-buttons",8),v.Nb(2,"ion-button"),v.Lb(3,"ion-icon"),v.Mb(),v.Mb(),v.Nb(4,"ion-segment",9),v.Ub("ionChange",(function(e){return v.dc(n),v.Xb().segmentChanged(e)})),v.Nb(5,"ion-segment-button",10),v.Nb(6,"ion-label"),v.kc(7,"All"),v.Mb(),v.Mb(),v.Nb(8,"ion-segment-button",11),v.Nb(9,"ion-label"),v.kc(10),v.Mb(),v.Mb(),v.Nb(11,"ion-segment-button",12),v.Nb(12,"ion-label"),v.kc(13,"Favorites"),v.Mb(),v.Mb(),v.Mb(),v.Nb(14,"ion-buttons",2),v.Nb(15,"ion-button",13),v.Ub("click",(function(){return v.dc(n),v.Xb().toggleSearchbar()})),v.Lb(16,"ion-icon",14),v.Mb(),v.Mb(),v.Mb()}if(2&e){var i=v.Xb();v.zb(4),v.ac("value",i.segment),v.zb(6),v.mc("Active (",i.getActiveGameCount(),")")}}function M(e,t){if(1&e){var n=v.Ob();v.Nb(0,"ion-searchbar",15),v.Ub("ionInput",(function(e){return v.dc(n),v.Xb().filterList(e)})),v.Mb()}if(2&e){var i=v.Xb();v.bc("value",i.searchTerm)}}function F(e,t){if(1&e&&(v.Nb(0,"ion-item",16),v.Nb(1,"h4"),v.kc(2,"The "),v.Nb(3,"span"),v.kc(4),v.Mb(),v.kc(5," are the Champions!"),v.Mb(),v.Mb()),2&e){var n=v.Xb(3);v.zb(3),v.ic("color: "+n.getWinner().mainColor),v.zb(1),v.lc(n.getWinner().fullName)}}function T(e,t){if(1&e&&(v.Nb(0,"h4"),v.kc(1,"Next Season Starts In:"),v.Lb(2,"br"),v.kc(3),v.Mb()),2&e){var n=v.Xb(3);v.zb(3),v.mc("",n.getNextSeasonStart(),".")}}function D(e,t){if(1&e&&(v.Nb(0,"div",21),v.kc(1),v.Mb()),2&e){var n=t.$implicit;v.zb(1),v.mc(" ",n.msg,"... \xa0 \xa0 \xa0 ")}}function I(e,t){if(1&e&&(v.Nb(0,"span"),v.Nb(1,"ion-item",16),v.Nb(2,"h4"),v.kc(3),v.Mb(),v.Mb(),v.jc(4,F,6,3,"ion-item",17),v.Nb(5,"ion-item",16),v.jc(6,T,4,1,"h4",3),v.Mb(),v.Nb(7,"div",18),v.Nb(8,"div",19),v.jc(9,D,2,1,"div",20),v.Mb(),v.Mb(),v.Mb()),2&e){var n=v.Xb(2);v.zb(3),v.mc("Season ",n.streamData.seasonNumber," is over."),v.zb(1),v.ac("ngIf",n.getWinner()&&n.getWinner().fullName),v.zb(2),v.ac("ngIf",n.countdown),v.zb(3),v.ac("ngForOf",n.globalEvents)}}function L(e,t){if(1&e&&(v.Nb(0,"h4",24),v.kc(1),v.Mb()),2&e){var n=v.Xb(4);v.zb(1),v.nc("Postseason Round ",n.streamData.games.postseason.round.roundNumber,", Day ",n.getPlayoffDay(),"")}}function j(e,t){if(1&e&&(v.Nb(0,"ion-item",16),v.jc(1,L,2,2,"h4",23),v.Mb()),2&e){var n=v.Xb(3);v.zb(1),v.ac("ngIf",n.streamData&&n.streamData.games)}}function S(e,t){if(1&e&&(v.Nb(0,"h4",24),v.kc(1),v.Mb()),2&e){var n=v.Xb(4);v.zb(1),v.nc("Season ",n.streamData.games.season.seasonNumber,", Day ",n.streamData.games.sim.day,"")}}function O(e,t){if(1&e&&(v.Nb(0,"ion-item",16),v.jc(1,S,2,2,"h4",23),v.Mb()),2&e){var n=v.Xb(3);v.zb(1),v.ac("ngIf",n.streamData&&n.streamData.games)}}function z(e,t){if(1&e&&(v.Nb(0,"span"),v.kc(1),v.Mb()),2&e){var n=v.Xb(4);v.zb(1),v.mc(" No active games for postseason day ",n.getPlayoffDay(),". ")}}function C(e,t){if(1&e&&(v.Nb(0,"span"),v.kc(1),v.Mb()),2&e){var n=v.Xb(4);v.zb(1),v.mc(" No active games for day ",n.streamData.games.sim.day,". ")}}function x(e,t){if(1&e&&(v.Nb(0,"ion-item",16),v.jc(1,z,2,1,"span",3),v.jc(2,C,2,1,"span",3),v.Mb()),2&e){var n=v.Xb(3);v.zb(1),v.ac("ngIf",n.streamData.games.isPostseason()),v.zb(1),v.ac("ngIf",!n.streamData.games.isPostseason())}}function A(e,t){if(1&e){var n=v.Ob();v.Nb(0,"ion-col",25),v.Nb(1,"app-diamond",26),v.Ub("refresh",(function(){return v.dc(n),v.Xb(3).refreshUI()})),v.Mb(),v.Mb()}if(2&e){var i=t.$implicit;v.zb(1),v.ac("game",i)}}function E(e,t){if(1&e&&(v.Nb(0,"span"),v.jc(1,j,2,1,"ion-item",17),v.jc(2,O,2,1,"ion-item",17),v.jc(3,x,3,2,"ion-item",17),v.Nb(4,"ion-grid"),v.Nb(5,"ion-row"),v.jc(6,A,2,1,"ion-col",22),v.Mb(),v.Mb(),v.Mb()),2&e){var n=v.Xb(2);v.zb(1),v.ac("ngIf",n.streamData.games.isPostseason()),v.zb(1),v.ac("ngIf",!n.streamData.games.isPostseason()),v.zb(1),v.ac("ngIf","active"===n.segment&&(!n.games||0===n.games.length)),v.zb(3),v.ac("ngForOf",n.games)("ngForTrackBy",n.gameId)}}function P(e,t){if(1&e&&(v.Nb(0,"span"),v.jc(1,I,10,4,"span",3),v.jc(2,E,7,5,"span",3),v.Mb()),2&e){var n=v.Xb();v.zb(1),v.ac("ngIf",n.isFinished()),v.zb(1),v.ac("ngIf",!n.isFinished())}}var R,U,X,q=[{path:"",component:(R=function(){function n(t,i,a,o,s){e(this,n),this.stream=t,this.database=i,this.loadingController=a,this.platform=o,this.settings=s,this.streamData=new d.a({}),this.games=[],this.segment="all",this.ready=!1,this.errors=0,this.lastUpdate=Date.now(),this.filterVisible=!1,this.stale=!1,this.staleThreshold=3e4,this.keepAwake=!1}var i,a,o;return i=n,(a=[{key:"ngOnInit",value:function(){return Object(l.a)(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.platform.ready();case 2:return console.debug("LiveFeed.ngOnInit()"),this.showLoading(),e.abrupt("return",this.settings.ready.finally((function(){return Object(l.a)(t,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.segment=this.settings.getSegment(),e.next=3,this.startListening();case 3:return e.abrupt("return",!0);case 4:case"end":return e.stop()}}),e,this)})))})));case 5:case"end":return e.stop()}}),e,this)})))}},{key:"ngOnDestroy",value:function(){return Object(l.a)(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",(this.ready=!1,this.subscription&&(this.subscription.unsubscribe(),this.subscription=void 0),!0));case 1:case"end":return e.stop()}}),e,this)})))}},{key:"scrollToTop",value:function(){return Object(l.a)(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.content.scrollToTop();case 1:case"end":return e.stop()}}),e,this)})))}},{key:"showLoading",value:function(){return Object(l.a)(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.loading=!0;case 1:case"end":return e.stop()}}),e,this)})))}},{key:"hideLoading",value:function(){return Object(l.a)(this,void 0,void 0,regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.loading=!1,this.ready=!0;case 1:case"end":return e.stop()}}),e,this)})))}},{key:"forceRefresh",value:function(e){var t=this;setTimeout((function(){t.stream.retry().finally((function(){e.target.complete()}))}),500)}},{key:"toggleSearchbar",value:function(){this.filterVisible=!this.filterVisible,console.debug("LiveFeed.toggleSearchbar(): filterVisible="+this.filterVisible)}},{key:"filterList",value:function(e){return this.searchTerm=e.srcElement.value,this.refreshUI()}},{key:"getActiveGames",value:function(){var e,t;return(null===(t=null===(e=this.streamData)||void 0===e?void 0:e.games)||void 0===t?void 0:t.schedule)?this.streamData.games.schedule.filter((function(e){return!e.gameComplete})):[]}},{key:"getActiveGameCount",value:function(){return this.getActiveGames().length}},{key:"getFavoriteGames",value:function(){var e,t,n,i,a=this;return(null===(t=null===(e=this.streamData)||void 0===e?void 0:e.games)||void 0===t?void 0:t.schedule)?null===(i=null===(n=this.streamData)||void 0===n?void 0:n.games)||void 0===i?void 0:i.schedule.filter((function(e){return a.settings.isFavorite(e.homeTeam)||a.settings.isFavorite(e.awayTeam)})):[]}},{key:"getSegmentGames",value:function(){var e,t,n=this;console.debug("LiveFeed.getSegmentGames()");var i=[];switch(this.segment){case"all":i=(null===(t=null===(e=this.streamData)||void 0===e?void 0:e.games)||void 0===t?void 0:t.schedule)||[];break;case"active":i=this.getActiveGames();break;case"favorites":i=this.getFavoriteGames();break;default:console.warn("LiveFeed.getSegmentGames(): unhandled segment: "+this.segment),i=[]}var a=this.settings.favoriteTeam();return i.sort((function(e,t){if(e.homeTeam===a||e.awayTeam===a)return-1;if(t.homeTeam===a||t.awayTeam===a)return 1;if(n.settings.isFavorite(e.homeTeam)||n.settings.isFavorite(e.awayTeam))return-1;if(n.settings.isFavorite(t.homeTeam)||n.settings.isFavorite(t.awayTeam))return 1;var i=e.homeTeamNickname,o=t.homeTeamNickname;return i<o?-1:i>o?1:0}))}},{key:"isPostseason",value:function(){var e,t;return(null===(t=null===(e=this.streamData)||void 0===e?void 0:e.games)||void 0===t?void 0:t.isPostseason())||!1}},{key:"isFinished",value:function(){var e,t,n=this,i=(null===(t=null===(e=this.streamData)||void 0===e?void 0:e.games)||void 0===t?void 0:t.isPostseasonComplete())||!1;return this.clockUpdater&&!i?(clearInterval(this.clockUpdater),this.clockUpdater=void 0,this.countdown=void 0):!this.clockUpdater&&i&&(this.clockUpdater=setInterval((function(){n.countdown=n.streamData.sim.countdownToNextSeason()}),1e3)),i}},{key:"getWinner",value:function(){var e,t,n,i,a=null===(i=null===(n=null===(t=null===(e=this.streamData)||void 0===e?void 0:e.games)||void 0===t?void 0:t.postseason)||void 0===n?void 0:n.playoffs)||void 0===i?void 0:i.winner;return a?this.streamData.leagues.teams.find((function(e){return e.id===a})):new m.a}},{key:"getPlayoffDay",value:function(){var e,t,n,i;return(null===(i=null===(n=null===(t=null===(e=this.streamData)||void 0===e?void 0:e.games)||void 0===t?void 0:t.postseason)||void 0===n?void 0:n.playoffs)||void 0===i?void 0:i.playoffDay)||0}},{key:"getNextSeasonStart",value:function(){return"".concat(this.countdown.hours," ").concat(1===this.countdown.hours?"hour":"hours",", ").concat(this.countdown.minutes," ").concat(1===this.countdown.minutes?"minute":"minutes",", ").concat(this.countdown.seconds," ").concat(1===this.countdown.seconds?"second":"seconds")}},{key:"refreshUI",value:function(){var e=this;console.debug("LiveFeed.refreshUI()");var t=this.getSegmentGames();return this.searchTerm&&this.searchTerm.length>=2&&(t=t.filter((function(t){return t.homeTeamName.toLowerCase().indexOf(e.searchTerm.toLowerCase())>-1||t.awayTeamName.toLowerCase().indexOf(e.searchTerm.toLowerCase())>-1}))),this.games=t,this.games}},{key:"segmentChanged",value:function(e){e&&e.detail&&e.detail.value&&(this.segment=e.detail.value,this.settings.setSegment(this.segment)),console.debug("LiveFeed.segmentChanged():",e),this.refreshUI()}},{key:"checkStale",value:function(){var e=this.stale;if(this.games&&this.games.length>0){var t=this.games.find((function(e){return!e.gameComplete}));this.stale=!!t&&this.lastUpdate+this.staleThreshold<Date.now()}console.debug("LiveFeed.checkStale(): ".concat(e," -> ").concat(this.stale))}},{key:"checkDisableSleep",value:function(){console.debug("LiveFeed.checkDisableSleep()");var e=this.settings.disableSleep();try{e&&this.getActiveGameCount()>0?this.keepAwake||(console.debug("LiveFeed.checkDisableSleep(): keeping awake"),this.keepAwake=!0,b.a.KeepAwake.keepAwake()):this.keepAwake&&(console.debug("LiveFeed.checkDisableSleep(): allowing sleep"),this.keepAwake=!1,b.a.KeepAwake.allowSleep())}catch(t){console.error("An error occurred setting keep-awake status.",t)}}},{key:"onEvent",value:function(e){return Object(l.a)(this,void 0,void 0,regeneratorRuntime.mark((function t(){var n,i,a,o,s=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(console.debug("LiveFeed.onEvent()"),!(e&&e instanceof ErrorEvent)){t.next=2;break}return t.abrupt("return",(console.warn("LiveFeed.onEvent(): got an error:",e),void this.onError(e)));case 2:for(n=e,this.lastUpdate=Date.now(),console.debug("LiveFeed.lastUpdate()",this.lastUpdate),setTimeout((function(){s.errors=0,s.checkStale()}),1e3),i=0,a=Object.keys(n.data);i<a.length;i++)o=a[i],this.streamData.data[o]=n.data[o];console.debug("LiveFeed.onEvent(): current data:",this.streamData),this.checkDisableSleep(),this.refreshUI(),this.hideLoading();case 6:case"end":return t.stop()}}),t,this)})))}},{key:"onError",value:function(e){var t=this;console.debug("LiveFeed.onError():",e),this.hideLoading(),setTimeout((function(){t.errors++,t.checkStale()}),1e3)}},{key:"startListening",value:function(){return Object(l.a)(this,void 0,void 0,regeneratorRuntime.mark((function e(){var t=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return console.debug("LiveFeed.startListening(): opening event stream to blaseball.com"),this.showLoading(),e.next=4,this.stream.subscribe((function(e){t.onEvent(e)}),(function(e){t.onError(e)}));case 4:this.subscription=e.sent,this.database.globalEvents().then((function(e){t.globalEvents=e.filter((function(e){return null===e.expire})),setTimeout((function(){var e=document.getElementById("marquee");e&&(new h.a(e),setTimeout((function(){e.setAttribute("style","visibility: visible")}),200))}),1e3)}));case 6:case"end":return e.stop()}}),e,this)})))}},{key:"gameId",value:function(e,t){return t&&t.id?t.id:String(e)}},{key:"schedule",get:function(){var e,t;return(null===(t=null===(e=this.streamData)||void 0===e?void 0:e.games)||void 0===t?void 0:t.schedule)||[]}}])&&t(i.prototype,a),o&&t(i,o),n}(),R.\u0275fac=function(e){return new(e||R)(v.Kb(g.a),v.Kb(p.a),v.Kb(o.Bb),v.Kb(o.Fb),v.Kb(y.a))},R.\u0275cmp=v.Eb({type:R,selectors:[["app-live-feed"]],viewQuery:function(e,t){var n;1&e&&v.pc(o.s,!0),2&e&&v.cc(n=v.Vb())&&(t.content=n.first)},decls:13,vars:5,consts:[[3,"translucent"],["color","primary",3,"click"],["slot","secondary"],[4,"ngIf"],["slot","fixed",3,"ionRefresh"],["pullingIcon","baseball-outline"],["name","default"],["debounce","200","showCancelButton","focus",3,"value","ionInput",4,"ngIf"],["slot","primary"],[3,"value","ionChange"],["value","all"],["value","active"],["value","favorites"],[3,"click"],["name","search-outline"],["debounce","200","showCancelButton","focus",3,"value","ionInput"],["lines","none"],["lines","none",4,"ngIf"],["id","marquee","data-speed","0.8"],[1,"marquee"],["class","marquee-item",4,"ngFor","ngForOf"],[1,"marquee-item"],["size","12",4,"ngFor","ngForOf","ngForTrackBy"],["class","ion-no-margin",4,"ngIf"],[1,"ion-no-margin"],["size","12"],[3,"game","refresh"]],template:function(e,t){1&e&&(v.Nb(0,"ion-header",0),v.Nb(1,"ion-toolbar",1),v.Ub("click",(function(){return t.scrollToTop()})),v.Nb(2,"ion-title"),v.kc(3," Blases Loaded "),v.Mb(),v.Nb(4,"ion-buttons",2),v.jc(5,w,2,0,"ion-button",3),v.Mb(),v.Mb(),v.jc(6,N,17,2,"ion-toolbar",3),v.Mb(),v.Nb(7,"ion-content"),v.Nb(8,"ion-refresher",4),v.Ub("ionRefresh",(function(e){return t.forceRefresh(e)})),v.Nb(9,"ion-refresher-content",5),v.Lb(10,"ion-spinner",6),v.Mb(),v.Mb(),v.jc(11,M,1,1,"ion-searchbar",7),v.jc(12,P,3,2,"span",3),v.Mb()),2&e&&(v.ac("translucent",!0),v.zb(5),v.ac("ngIf",t.loading||t.stale),v.zb(1),v.ac("ngIf",t.ready&&!t.isFinished()),v.zb(5),v.ac("ngIf",t.filterVisible),v.zb(1),v.ac("ngIf",t.ready))},directives:[o.z,o.xb,o.vb,o.j,s.t,o.s,o.Y,o.Z,o.nb,o.i,o.A,o.gb,o.Ib,o.hb,o.L,o.fb,o.Jb,o.F,s.s,o.y,o.eb,o.r,k.a],styles:[".danger[_ngcontent-%COMP%]{color:#fff;background-color:var(--ion-color-danger);text-align:center;padding:4em}.danger[_ngcontent-%COMP%]   .big[_ngcontent-%COMP%]{font-size:200%;font-weight:700}ion-item[_ngcontent-%COMP%], ion-searchbar[_ngcontent-%COMP%]{transition:.1s ease-in-out}#marquee[_ngcontent-%COMP%]{visibility:hidden}.marquee[_ngcontent-%COMP%]{position:absolute;bottom:0;overflow:hidden;white-space:nowrap;padding:.5em 0}.marquee-item[_ngcontent-%COMP%]{display:inline-block}"]}),R)}],G=((X=function t(){e(this,t)}).\u0275mod=v.Ib({type:X}),X.\u0275inj=v.Hb({factory:function(e){return new(e||X)},imports:[[u.l.forChild(q)],u.l]}),X),B=((U=function t(){e(this,t)}).\u0275mod=v.Ib({type:U}),U.\u0275inj=v.Hb({factory:function(e){return new(e||U)},imports:[[o.zb,s.c,r.e,G,c.a]]}),U)}}])}();