(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{v2dp:function(e,t,i){"use strict";i.r(t),i.d(t,"LiveFeedPageModule",(function(){return R}));var n=i("TEn/"),s=i("ofXK"),o=i("3Pt+"),a=i("Uyg3"),r=i("tyNb"),c=i("mrSG"),l=i("gcOT");class d{constructor(e){if("object"==typeof e)this.el=e;else{if("string"!=typeof e)throw new TypeError("Marquee accepts either a HTML Element (object) or a class/id to query (string).");this.el=document.querySelector(e)}this.sign=this.el.children[0],this.RAF=null,this.offset=this.el.offsetWidth,this.speed=this.el.dataset.speed||1,this.onResize=this.getSignWidth.bind(this),this.styleElements(),this.init()}init(){this.getSignWidth(),this.draw(),window.addEventListener("resize",this.onResize)}styleElements(){this.el.style.display="flex",this.sign.style.display="inline-flex"}getSignWidth(){this.signWidth=this.sign.clientWidth}draw(){const e=()=>{this.RAF=requestAnimationFrame(e),-this.offset>=this.signWidth&&this.reset(),this.offset=this.offset-this.speed,this.sign.style.transform=`translate3d(${this.offset}px, 0, 0)`};requestAnimationFrame(e)}stop(){cancelAnimationFrame(this.RAF)}reset(){this.offset=this.el.offsetWidth,this.sign.style.transform=`translate3d(${this.offset}px, 0, 0)`}destroy(){this.stop(),window.removeEventListener("resize",this.onResize)}}var h=i("+BjT"),b=i("cHMN"),u=i("fXoL"),m=i("N1zj"),g=i("J+wX"),f=i("BTjV"),v=i("9Pn0");function p(e,t){1&e&&(u.Nb(0,"ion-button"),u.Lb(1,"ion-spinner"),u.Mb())}function w(e,t){if(1&e){const e=u.Ob();u.Nb(0,"ion-toolbar"),u.Nb(1,"ion-buttons",8),u.Nb(2,"ion-button"),u.Lb(3,"ion-icon"),u.Mb(),u.Mb(),u.Nb(4,"ion-segment",9),u.Vb("ionChange",(function(t){return u.fc(e),u.Zb().segmentChanged(t)})),u.Nb(5,"ion-segment-button",10),u.Nb(6,"ion-label"),u.mc(7,"All"),u.Mb(),u.Mb(),u.Nb(8,"ion-segment-button",11),u.Nb(9,"ion-label"),u.mc(10),u.Mb(),u.Mb(),u.Nb(11,"ion-segment-button",12),u.Nb(12,"ion-label"),u.mc(13,"Favorites"),u.Mb(),u.Mb(),u.Mb(),u.Nb(14,"ion-buttons",2),u.Nb(15,"ion-button",13),u.Vb("click",(function(){return u.fc(e),u.Zb().toggleSearchbar()})),u.Lb(16,"ion-icon",14),u.Mb(),u.Mb(),u.Mb()}if(2&e){const e=u.Zb();u.zb(4),u.cc("value",e.segment),u.zb(6),u.oc("Active (",e.getActiveGameCount(),")")}}function N(e,t){if(1&e){const e=u.Ob();u.Nb(0,"ion-searchbar",15),u.Vb("ionInput",(function(t){return u.fc(e),u.Zb().filterList(t)})),u.Mb()}if(2&e){const e=u.Zb();u.dc("value",e.searchTerm)}}function y(e,t){if(1&e&&(u.Nb(0,"ion-item",16),u.Nb(1,"h4"),u.mc(2,"The "),u.Nb(3,"span"),u.mc(4),u.Mb(),u.mc(5," are the Champions!"),u.Mb(),u.Mb()),2&e){const e=u.Zb(3);u.zb(3),u.kc("color: "+e.uiState.winner.mainColor),u.zb(1),u.nc(e.uiState.winner.fullName)}}function S(e,t){if(1&e&&(u.Nb(0,"ion-item",16),u.Nb(1,"h4"),u.mc(2),u.Lb(3,"br"),u.mc(4),u.Mb(),u.Mb()),2&e){const e=u.Zb(3);u.zb(2),u.oc(" ",e.uiState.countdownNotice," "),u.zb(2),u.oc(" ",e.getCountdown()," ")}}function M(e,t){1&e&&(u.Nb(0,"ion-item",16),u.Nb(1,"h4"),u.mc(2,"Next season starts in... uhh. "),u.Nb(3,"i"),u.mc(4,"*tugs collar*"),u.Mb(),u.mc(5," I mean. What "),u.Nb(6,"i"),u.mc(7,"is"),u.Mb(),u.mc(8," time, really?"),u.Mb(),u.Mb())}function T(e,t){if(1&e&&(u.Nb(0,"div",21),u.mc(1),u.Mb()),2&e){const e=t.$implicit;u.zb(1),u.oc(" ",e.msg,"... \xa0 \xa0 \xa0 ")}}function k(e,t){if(1&e&&(u.Nb(0,"span"),u.Nb(1,"ion-item",16),u.Nb(2,"h4"),u.mc(3),u.Mb(),u.Mb(),u.lc(4,y,6,3,"ion-item",17),u.lc(5,S,5,2,"ion-item",17),u.lc(6,M,9,0,"ion-item",17),u.Nb(7,"div",18),u.Nb(8,"div",19),u.lc(9,T,2,1,"div",20),u.Mb(),u.Mb(),u.Mb()),2&e){const e=u.Zb(2);u.zb(3),u.nc(e.uiState.notice),u.zb(1),u.cc("ngIf",e.uiState.winner),u.zb(1),u.cc("ngIf",e.uiState.countdownNotice&&e.countdown&&e.countdown.diff>=0),u.zb(1),u.cc("ngIf",e.uiState.countdownNotice&&e.countdown&&e.countdown.diff<0),u.zb(3),u.cc("ngForOf",e.globalEvents)}}function F(e,t){if(1&e){const e=u.Ob();u.Nb(0,"ion-col",24),u.Nb(1,"app-diamond",25),u.Vb("refresh",(function(){return u.fc(e),u.Zb(4).refreshUI()})),u.Mb(),u.Mb()}if(2&e){const e=t.$implicit;u.zb(1),u.cc("game",e)}}function O(e,t){if(1&e&&(u.Nb(0,"span"),u.Nb(1,"ion-grid",22),u.Nb(2,"ion-row"),u.lc(3,F,2,1,"ion-col",23),u.Mb(),u.Mb(),u.Mb()),2&e){const e=u.Zb(3);u.zb(3),u.cc("ngForOf",e.streamData.fights.bossFights)("ngForTrackBy",e.gameId)}}function I(e,t){if(1&e&&(u.Nb(0,"h4",27),u.mc(1),u.Mb()),2&e){const e=u.Zb(5);u.zb(1),u.nc(e.uiState.seasonHeader)}}function L(e,t){if(1&e&&(u.Nb(0,"ion-item",16),u.lc(1,I,2,1,"h4",26),u.Mb()),2&e){const e=u.Zb(4);u.zb(1),u.cc("ngIf",e.streamData&&e.streamData.games)}}function E(e,t){if(1&e&&(u.Nb(0,"ion-item",16),u.mc(1),u.Mb()),2&e){const e=u.Zb(4);u.zb(1),u.oc(" No active games for day ",e.streamData.games.sim.day,". ")}}function D(e,t){if(1&e){const e=u.Ob();u.Nb(0,"ion-col",24),u.Nb(1,"app-diamond",25),u.Vb("refresh",(function(){return u.fc(e),u.Zb(4).refreshUI()})),u.Mb(),u.Mb()}if(2&e){const e=t.$implicit;u.zb(1),u.cc("game",e)}}function z(e,t){if(1&e&&(u.Nb(0,"span"),u.lc(1,L,2,1,"ion-item",17),u.lc(2,E,2,1,"ion-item",17),u.Nb(3,"ion-grid",22),u.Nb(4,"ion-row"),u.lc(5,D,2,1,"ion-col",23),u.Mb(),u.Mb(),u.Mb()),2&e){const e=u.Zb(3);u.zb(1),u.cc("ngIf",e.uiState.seasonHeader),u.zb(1),u.cc("ngIf","active"===e.segment&&(!e.games||0===e.games.length)),u.zb(3),u.cc("ngForOf",e.games)("ngForTrackBy",e.gameId)}}function C(e,t){if(1&e&&(u.Nb(0,"span"),u.lc(1,O,4,2,"span",3),u.lc(2,z,6,4,"span",3),u.Mb()),2&e){const e=u.Zb(2);u.zb(1),u.cc("ngIf",e.phase===e.PHASES.BOSS_FIGHT),u.zb(1),u.cc("ngIf",e.phase!==e.PHASES.BOSS_FIGHT)}}function A(e,t){if(1&e&&(u.Nb(0,"span"),u.lc(1,k,10,5,"span",3),u.lc(2,C,3,2,"span",3),u.Mb()),2&e){const e=u.Zb();u.zb(1),u.cc("ngIf",e.uiState.notice),u.zb(1),u.cc("ngIf",!e.uiState.notice)}}const P=[{path:"",component:(()=>{class e{constructor(e,t,i,n,s){this.stream=e,this.database=t,this.loadingController=i,this.platform=n,this.settings=s,this.streamData=new h.a({}),this.games=[],this.segment="all",this.ready=!1,this.errors=0,this.lastUpdate=Date.now(),this.filterVisible=!1,this.stale=!1,this.staleThreshold=3e4,this.keepAwake=!1,this.PHASES=b.a,this.uiState={}}get schedule(){var e,t;return(null===(t=null===(e=this.streamData)||void 0===e?void 0:e.games)||void 0===t?void 0:t.schedule)||[]}ngOnInit(){return Object(c.a)(this,void 0,void 0,(function*(){return yield this.platform.ready(),yield this.settings.ready,console.debug("LiveFeed.ngOnInit()"),this.showLoading(),this.segment=this.settings.segment(),yield this.startListening(),!0}))}ngOnDestroy(){return Object(c.a)(this,void 0,void 0,(function*(){return this.ready=!1,this.subscription&&(this.subscription.unsubscribe(),this.subscription=void 0),!0}))}scrollToTop(){return Object(c.a)(this,void 0,void 0,(function*(){this.content.scrollToTop()}))}showLoading(){return Object(c.a)(this,void 0,void 0,(function*(){this.loading=!0}))}hideLoading(){return Object(c.a)(this,void 0,void 0,(function*(){this.loading=!1,this.ready=!0}))}forceRefresh(e){setTimeout(()=>{this.stream.retry().finally(()=>{var t;null===(t=null==e?void 0:e.target)||void 0===t||t.complete()})},500)}toggleSearchbar(){this.filterVisible=!this.filterVisible,console.debug("LiveFeed.toggleSearchbar(): filterVisible="+this.filterVisible)}filterList(e){return this.searchTerm=e.srcElement.value,this.refreshUI()}getActiveGames(){var e,t;return(null===(t=null===(e=this.streamData)||void 0===e?void 0:e.games)||void 0===t?void 0:t.schedule)?this.streamData.games.schedule.filter(e=>e.inProgress):[]}getActiveGameCount(){return this.getActiveGames().length}getFavoriteGames(){var e,t,i,n;return(null===(t=null===(e=this.streamData)||void 0===e?void 0:e.games)||void 0===t?void 0:t.schedule)?null===(n=null===(i=this.streamData)||void 0===i?void 0:i.games)||void 0===n?void 0:n.schedule.filter(e=>this.settings.isFavorite(e.homeTeam)||this.settings.isFavorite(e.awayTeam)):[]}getSegmentGames(){var e,t;console.debug("LiveFeed.getSegmentGames()");let i=[];switch(this.segment){case"all":i=(null===(t=null===(e=this.streamData)||void 0===e?void 0:e.games)||void 0===t?void 0:t.schedule)||[];break;case"active":i=this.getActiveGames();break;case"favorites":i=this.getFavoriteGames();break;default:console.warn("LiveFeed.getSegmentGames(): unhandled segment: "+this.segment),i=[]}const n=this.settings.favoriteTeam();return i.sort((e,t)=>{if(e.homeTeam===n||e.awayTeam===n)return-1;if(t.homeTeam===n||t.awayTeam===n)return 1;if(this.settings.isFavorite(e.homeTeam)||this.settings.isFavorite(e.awayTeam))return-1;if(this.settings.isFavorite(t.homeTeam)||this.settings.isFavorite(t.awayTeam))return 1;const i=e.homeTeamNickname,s=t.homeTeamNickname;return i<s?-1:i>s?1:0})}doCountdown(e){this.clockUpdater||(this.clockUpdater=setInterval(()=>{this.countdown=this.streamData.sim[e]()},1e3))}getWinner(){var e,t,i,n;const s=null===(n=null===(i=null===(t=null===(e=this.streamData)||void 0===e?void 0:e.games)||void 0===t?void 0:t.postseason)||void 0===i?void 0:i.playoffs)||void 0===n?void 0:n.winner;if(s)return this.streamData.leagues.teams.find(e=>e.id===s)}getPlayoffDay(){var e,t,i,n;return(null===(n=null===(i=null===(t=null===(e=this.streamData)||void 0===e?void 0:e.games)||void 0===t?void 0:t.postseason)||void 0===i?void 0:i.playoffs)||void 0===n?void 0:n.playoffDay)||0}getCountdown(){return`${this.countdown.hours} ${1===this.countdown.hours?"hour":"hours"}, ${this.countdown.minutes} ${1===this.countdown.minutes?"minute":"minutes"}, ${this.countdown.seconds} ${1===this.countdown.seconds?"second":"seconds"}`}refreshUI(){console.debug("LiveFeed.refreshUI()");let e=this.getSegmentGames();return this.searchTerm&&this.searchTerm.length>=2&&(e=e.filter(e=>e.homeTeamName.toLowerCase().indexOf(this.searchTerm.toLowerCase())>-1||e.awayTeamName.toLowerCase().indexOf(this.searchTerm.toLowerCase())>-1)),this.games=e,this.games}segmentChanged(e){e&&e.detail&&e.detail.value&&(this.segment=e.detail.value,this.settings.setSegment(this.segment)),console.debug("LiveFeed.segmentChanged():",e),this.refreshUI()}checkStale(){const e=this.stale;if(this.games&&this.games.length>0){const e=this.games.find(e=>e.inProgress);this.stale=!!e&&this.lastUpdate+this.staleThreshold<Date.now()}console.debug(`LiveFeed.checkStale(): ${e} -> ${this.stale}`)}checkDisableSleep(){console.debug("LiveFeed.checkDisableSleep()");const e=this.settings.disableSleep();if(l.a.KeepAwake)try{e&&this.getActiveGameCount()>0?this.keepAwake||(console.debug("LiveFeed.checkDisableSleep(): keeping awake"),this.keepAwake=!0,l.a.KeepAwake.keepAwake()):this.keepAwake&&(console.debug("LiveFeed.checkDisableSleep(): allowing sleep"),this.keepAwake=!1,l.a.KeepAwake.allowSleep())}catch(t){console.error("An error occurred setting keep-awake status.",t)}}onEvent(e){return Object(c.a)(this,void 0,void 0,(function*(){if(console.debug("LiveFeed.onEvent()"),e&&e instanceof ErrorEvent)return console.warn("LiveFeed.onEvent(): got an error:",e),void this.onError(e);const t=e;this.lastUpdate=Date.now(),console.debug("LiveFeed.lastUpdate()",this.lastUpdate),setTimeout(()=>{this.errors=0,this.checkStale()},1e3);for(const e of Object.keys(t.data))this.streamData.data[e]=t.data[e];console.debug("LiveFeed.onEvent(): current data:",this.streamData),this.onUpdate()}))}onError(e){console.debug("LiveFeed.onError():",e),this.onUpdate(),setTimeout(()=>{this.errors++,this.checkStale()},1e3)}onUpdate(){return Object(c.a)(this,void 0,void 0,(function*(){this.checkDisableSleep(),this.refreshUI();const e={seasonHeader:void 0,notice:void 0,countdownNotice:void 0,winner:void 0},t=this.streamData.games.sim.day,i=this.streamData.sim.playOffRound,n=this.streamData.sim.phase;switch(n){case b.a.PRESEASON:case b.a.PRE_ELECTION:case b.a.POST_PRE_ELECTION:case b.a.POST_ELECTION:this.doCountdown("countdownToNextSeason"),e.notice=`Season ${this.streamData.seasonNumber} is over.`,e.countdownNotice="Next season starts in:",e.winner=this.getWinner();break;case b.a.PRE_OFFSEASON:case b.a.OFFSEASON:this.doCountdown("countdownToNextPhase"),e.notice=`Regular Season ${this.streamData.seasonNumber} is over.`,e.countdownNotice="The wildcard round starts in:";break;case b.a.POST_WILDCARD:this.doCountdown("countdownToNextPhase"),e.notice="The wildcard round is complete.",e.countdownNotice="The playoffs start in:";break;case b.a.WILDCARD:if(1===i){e.seasonHeader="Wildcard Round, Day "+t;break}case b.a.POSTSEASON:e.seasonHeader=`Postseason Round ${this.streamData.games.postseason.round.roundNumber}, Day ${t}`;break;default:e.seasonHeader=`Season ${this.streamData.games.season.seasonNumber}, Day ${t}`}!this.uiState.notice&&this.clockUpdater&&(clearInterval(this.clockUpdater),this.clockUpdater=void 0,this.countdown=void 0),this.phase=n,Object.assign(this.uiState,e),this.hideLoading()}))}startListening(){var e;return Object(c.a)(this,void 0,void 0,(function*(){console.debug("LiveFeed.startListening(): opening event stream to blaseball.com"),this.showLoading(),null===(e=this.subscription)||void 0===e||e.unsubscribe(),this.subscription=yield this.stream.subscribe(e=>{this.onEvent(e)},e=>{this.onError(e)}),this.database.globalEvents().then(e=>{this.globalEvents=e.filter(e=>null===e.expire),setTimeout(()=>{const e=document.getElementById("marquee");e&&(new d(e),setTimeout(()=>{e.setAttribute("style","visibility: visible")},200))},1e3)})}))}gameId(e,t){return t&&t.id?t.id:String(e)}}return e.\u0275fac=function(t){return new(t||e)(u.Kb(m.a),u.Kb(g.a),u.Kb(n.Ab),u.Kb(n.Eb),u.Kb(f.a))},e.\u0275cmp=u.Eb({type:e,selectors:[["app-live-feed"]],viewQuery:function(e,t){var i;1&e&&u.sc(n.r,!0),2&e&&u.ec(i=u.Wb())&&(t.content=i.first)},decls:13,vars:4,consts:[["translucent","true"],["color","primary",3,"click"],["slot","secondary"],[4,"ngIf"],["slot","fixed",3,"ionRefresh"],["pullingIcon","baseball-outline"],["name","default"],["debounce","200","showCancelButton","focus",3,"value","ionInput",4,"ngIf"],["slot","primary"],[3,"value","ionChange"],["value","all"],["value","active"],["value","favorites"],[3,"click"],["name","search-outline"],["debounce","200","showCancelButton","focus",3,"value","ionInput"],["lines","none"],["lines","none",4,"ngIf"],["id","marquee","data-speed","1"],[1,"marquee"],["class","marquee-item",4,"ngFor","ngForOf"],[1,"marquee-item"],[2,"margin-top","0","padding-top","0"],["size","12",4,"ngFor","ngForOf","ngForTrackBy"],["size","12"],["prefix","live-diamond",3,"game","refresh"],["class","ion-no-margin",4,"ngIf"],[1,"ion-no-margin"]],template:function(e,t){1&e&&(u.Nb(0,"ion-header",0),u.Nb(1,"ion-toolbar",1),u.Vb("click",(function(){return t.scrollToTop()})),u.Nb(2,"ion-title"),u.mc(3,"Blases Loaded"),u.Mb(),u.Nb(4,"ion-buttons",2),u.lc(5,p,2,0,"ion-button",3),u.Mb(),u.Mb(),u.Mb(),u.Nb(6,"ion-content"),u.lc(7,w,17,2,"ion-toolbar",3),u.Nb(8,"ion-refresher",4),u.Vb("ionRefresh",(function(e){return t.forceRefresh(e)})),u.Nb(9,"ion-refresher-content",5),u.Lb(10,"ion-spinner",6),u.Mb(),u.Mb(),u.lc(11,N,1,1,"ion-searchbar",7),u.lc(12,A,3,2,"span",3),u.Mb()),2&e&&(u.zb(5),u.cc("ngIf",t.loading||t.stale),u.zb(2),u.cc("ngIf",t.ready&&!t.uiState.notice),u.zb(4),u.cc("ngIf",t.filterVisible),u.zb(1),u.cc("ngIf",t.ready))},directives:[n.y,n.wb,n.ub,n.i,s.t,n.r,n.X,n.Y,n.mb,n.h,n.z,n.fb,n.Hb,n.gb,n.K,n.eb,n.Ib,n.E,s.s,n.x,n.db,n.q,v.a],styles:[".danger[_ngcontent-%COMP%]{color:#fff;background-color:var(--ion-color-danger);text-align:center;padding:4em}.danger[_ngcontent-%COMP%]   .big[_ngcontent-%COMP%]{font-size:200%;font-weight:700}ion-item[_ngcontent-%COMP%], ion-searchbar[_ngcontent-%COMP%]{transition:.1s ease-in-out}#marquee[_ngcontent-%COMP%]{visibility:hidden}.marquee[_ngcontent-%COMP%]{position:absolute;bottom:0;overflow:hidden;white-space:nowrap;padding:.5em 0}.marquee-item[_ngcontent-%COMP%]{display:inline-block}"]}),e})()}];let U=(()=>{class e{}return e.\u0275mod=u.Ib({type:e}),e.\u0275inj=u.Hb({factory:function(t){return new(t||e)},imports:[[r.l.forChild(P)],r.l]}),e})(),R=(()=>{class e{}return e.\u0275mod=u.Ib({type:e}),e.\u0275inj=u.Hb({factory:function(t){return new(t||e)},imports:[[n.yb,s.c,o.e,U,a.a]]}),e})()}}]);