{"version":3,"sources":["webpack:///src/app/standings/standings.page.html","webpack:///src/app/standings/standings-routing.module.ts","webpack:///src/app/standings/standings.page.ts","webpack:///src/app/standings/standings.module.ts"],"names":["StandingsPage","StandingsPageModule","StandingsPageRoutingModule","routes","path","component","database","modalController","platform","stream","loading","leagues","standings","tiebreakers","data","subleagues","this","ready","subscribe","evt","games","postprocess","id","modal","console","debug","create","componentProps","present","l","teams","name","sortByWins","a","b","ret","wins","order","indexOf","find","tiebreaker","sl","filter","s","map","subLeagueData","teamsData","d","divisions","item","sort","div","divisionData","team","teamData","fullName","emoji","emojiColor","mainColor","secondaryColor","mainTextColor","contrastingMainColor","secondaryTextColor","contrastingSecondaryColor","losses","playoffs","push","_","index","forChild"],"mappings":"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","file":"x","sourcesContent":["<ion-header [translucent]=\"true\">\n  <ion-toolbar color=\"primary\">\n    <ion-title>\n      Standings\n    </ion-title>\n    <ion-buttons slot=\"secondary\">\n      <ion-button *ngIf=\"loading\">\n        <ion-spinner></ion-spinner>\n      </ion-button>\n    </ion-buttons>\n  </ion-toolbar>\n</ion-header>\n\n<ion-content class=\"ion-no-margin\">\n  <ion-grid>\n    <ion-row>\n      <ion-col *ngFor=\"let subleague of data.subleagues; trackBy: id\">\n        <ion-header class=\"ion-no-border ion-text-center\">\n          <h4>{{subleague.name}}</h4>\n        </ion-header>\n        <ion-card class=\"ion-no-padding ion-no-margin ion-margin-vertical\" *ngFor=\"let division of subleague.divisions; trackBy: id\">\n          <ion-card-header>\n            <ion-card-subtitle>{{division.name}}</ion-card-subtitle>\n          </ion-card-header>\n          <ion-card-content class=\"ion-no-padding\">\n            <ion-item\n              lines=\"none\"\n              class=\"team-row\"\n              [style]=\"'--background: ' + team.mainColor + '; --color: ' + team.mainTextColor\"\n              *ngFor=\"let team of division.teams; trackBy: id\"\n              (click)=\"openTeam(team.id)\"\n            >\n              <ion-label class=\"team-name\">{{team.name}}</ion-label>\n              <ion-note class=\"team-wins\" slot=\"end\" [style]=\"'--color: ' + team.mainTextColor\">\n                {{team.wins}}-{{team.losses}}\n              <!--\n                <div class=\"playoffs\" *ngIf=\"team.playoffs\">üèÜ</div>\n                <div class=\"playoffs\" *ngIf=\"!team.playoffs\">&nbsp;</div>\n              -->\n            </ion-note>\n            </ion-item>\n          </ion-card-content>\n        </ion-card>\n      </ion-col>\n    </ion-row>\n  </ion-grid>\n</ion-content>\n","import { NgModule } from '@angular/core';\nimport { RouterModule, Routes } from '@angular/router';\nimport { StandingsPage } from './standings.page';\n\nconst routes: Routes = [\n  {\n    path: '',\n    component: StandingsPage,\n  }\n];\n\n@NgModule({\n  imports: [RouterModule.forChild(routes)],\n  exports: [RouterModule]\n})\nexport class StandingsPageRoutingModule {}\n","import { Component, OnInit } from '@angular/core';\nimport { ModalController, Platform } from '@ionic/angular';\n\nimport { APIStream } from 'src/lib/api/stream';\nimport { StreamData } from 'src/lib/model/streamData';\nimport { Standings } from 'src/lib/model/standings';\nimport { Team } from 'src/lib/model/team';\nimport { Leagues } from 'src/lib/model/leagues';\nimport { Subleague } from 'src/lib/model/subleague';\nimport { Division } from 'src/lib/model/division';\nimport { APIDatabase } from 'src/lib/api/database';\nimport { Tiebreaker } from 'src/lib/model/tiebreaker';\nimport { TeamPage } from '../team-page/team-page.page';\n\ninterface LeagueData {\n  id: string;\n  name: string;\n  subleagues: SubleagueData[];\n}\n\ninterface SubleagueData {\n  id: string;\n  name: string;\n  divisions: DivisionData[];\n}\n\ninterface DivisionData {\n  id: string;\n  name: string;\n  teams: TeamData[];\n}\n\ninterface TeamData {\n  id: string;\n  name: string;\n  wins: number;\n  losses: number;\n  playoffs: boolean;\n}\n\n@Component({\n  selector: 'app-standings',\n  templateUrl: 'standings.page.html',\n  styleUrls: ['standings.page.scss']\n})\nexport class StandingsPage implements OnInit {\n  loading = true;\n  leagues = new Leagues({});\n  standings = new Standings({});\n  tiebreakers = new Tiebreaker({});\n\n  data = { subleagues: [] } as LeagueData;\n\n  constructor(\n    private database: APIDatabase,\n    private modalController: ModalController,\n    private platform: Platform,\n    private stream: APIStream,\n  ) {\n  }\n\n  async ngOnInit(): Promise<void> {\n    await this.platform.ready();\n    this.stream.subscribe(async (evt: StreamData|Event) => {\n      if (evt instanceof StreamData) {\n        this.leagues = evt.leagues;\n        this.standings = evt.games.standings;\n      }\n      this.postprocess();\n    });\n  }\n\n  async openTeam(id: string) {\n    console.debug(`opening team: ${id}`);\n    const modal = await this.modalController.create({\n      component: TeamPage,\n      componentProps: {\n        id,\n      },\n    });\n    return await modal.present();\n  }\n\n  async postprocess() {\n    const l = this.leagues?.leagues[0];\n    if (!l) {\n      return;\n    }\n\n    this.data.name = l.name;\n\n    const sortByWins = (a: Team, b: Team) => {\n      const aWins = this.standings.wins[a.id];\n      const bWins = this.standings.wins[b.id];\n\n      let ret = bWins - aWins;\n      if (ret === 0) {\n        const aTiebreaker = this.tiebreakers.order.indexOf(a.id);\n        const bTiebreaker = this.tiebreakers.order.indexOf(b.id);\n\n        ret = aTiebreaker - bTiebreaker;\n      }\n\n      return ret;\n    };\n\n    this.tiebreakers = this.leagues.tiebreakers.find((tiebreaker: Tiebreaker) => tiebreaker.id === l.tiebreakers);\n    const teams = await this.database.teams();\n\n    const sl = this.leagues?.subleagues?.filter((s: Subleague) => {\n      return l.subleagues.indexOf(s.id) >= 0;\n    });\n\n    this.data.subleagues = sl.map((s: Subleague) => {\n      const subLeagueData = {\n        id: s.id,\n        name: s.name,\n      } as SubleagueData;\n\n      const teamsData = [] as TeamData[];\n\n      const d = this.leagues?.divisions?.filter((item: Division) => {\n        return s.divisions.indexOf(item.id) >= 0;\n      });\n\n      subLeagueData.divisions = d.sort((a: Division, b: Division) => {\n        return a.name < b.name ? -1 : a.name > b.name ? 1 : 0;\n      }).map((div: Division) => {\n        const divisionData = {\n          id: div.id,\n          name: div.name,\n        } as DivisionData;\n\n        divisionData.teams = div.teams\n          .map((id: string) => teams.find((team: Team) => id === team.id))\n          .sort(sortByWins)\n          .map((team: Team) => {\n          const teamData = {\n            id: team.id,\n            name: team.fullName,\n            emoji: team.emoji,\n            emojiColor: team.emojiColor,\n            mainColor: team.mainColor,\n            secondaryColor: team.secondaryColor,\n            mainTextColor: team.contrastingMainColor,\n            secondaryTextColor: team.contrastingSecondaryColor,\n            wins: this.standings.wins[team.id],\n            losses: this.standings.losses[team.id],\n            playoffs: false,\n          };\n\n          teamsData.push(teamData);\n\n          return teamData;\n        });\n\n        return divisionData;\n      });\n\n      teamsData.sort((a: TeamData, b: TeamData) => {\n        let ret = b.wins - a.wins;\n        if (ret === 0) {\n          ret = this.tiebreakers.order.indexOf(a.id) - this.tiebreakers.order.indexOf(b.id);\n        }\n\n        return ret;\n      }).filter((_, index) => {\n        return index < 4;\n      }).map((team: TeamData) => {\n        team.playoffs = true;\n      });\n\n      return subLeagueData;\n    });\n\n    this.loading = false;\n    // console.debug('leagues:', this.leagues);\n    // console.debug('standings:', this.standings);\n    // console.debug('teams:', teams);\n    // console.debug('data:', this.data);\n  }\n\n  id(item: any) {\n    if (item && item.id) {\n      return item.id;\n    }\n    return item;\n  }\n}\n","import { IonicModule } from '@ionic/angular';\nimport { NgModule } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { FormsModule } from '@angular/forms';\nimport { StandingsPage } from './standings.page';\n\nimport { StandingsPageRoutingModule } from './standings-routing.module';\n\n@NgModule({\n  imports: [\n    IonicModule,\n    CommonModule,\n    FormsModule,\n    StandingsPageRoutingModule\n  ],\n  declarations: [StandingsPage]\n})\nexport class StandingsPageModule {}\n"]}